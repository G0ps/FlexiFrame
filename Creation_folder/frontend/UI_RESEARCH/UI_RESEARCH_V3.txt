+++++++++++++++++++++++++++++++++++++++
PYTHON DICT ONLY RESPONSE (STRICT)

IMPORTANT: The "logic" field inside each function **must be JavaScript code** that manipulates the DOM in the browser. Do NOT use Python or any other language. The Python dict is only for schema structure (functions, elements, CSS).

The function logic should **highly rely on user input** when present. For example, if the user asks "get me only 3 comments from a comment endpoint," the logic must reflect that using JavaScript, DOM updates, and async network requests (do_get, do_post, etc.).

UI Schema & Interpreter — Comprehensive Summary
This document describes the schema-driven UI model and the interpreter/engine. It explains the schema structure, function compilation with async handling, event wiring, parameter typing, networking helpers, execution flow, examples, validation, security considerations, and extension points.

1. High-level Purpose

A declarative, JSON-driven UI system that:

Defines UI structure (pure HTML elements), CSS, and executable logic in a single schema.

Compiles function logic into real async JavaScript functions stored in a global registry (FUNCTIONS_SET / ALL_FUNCTIONS).

Renders DOM (no React, no JSX) and injects CSS at runtime.

Binds events to compiled functions, passing typed parameters extracted from the DOM.

Supports nested function calls (logic may call other registered functions).

Includes a generic HTTP helper layer (doGet, doPost, doPut, doPatch, doDelete) with sensible defaults.

This is suitable for dynamic UIs driven by remote schemas, low-footprint pages, or CMS-driven frontends.

2. Schema Shape (Top-Level)
{
  "functions": [ /* compiled to FUNCTIONS_SET */ ],
  "elements": [ /* declarative DOM tree */ ],
  "css": [ /* list of selector+rules blocks */ ]
}

2.1 functions Item
{
  "function_id": "unique-id",
  "name": "optionalName",
  "params": [
    { "name": "p1", "type": "number" }
  ],
  "logic": "/* JS code executed in strict mode */"
}


function_id: registry key used by events and other functions.

params: ordered parameter list with explicit name and type.

Supported types: number, string, boolean, element, object, array.

logic: only the function body, not a full function declaration. The interpreter wraps it in an async arrow function.

Nested Calls

Functions may call other registered functions via ALL_FUNCTIONS:

const a = await ALL_FUNCTIONS['parse_num'](rawA);
const result = await ALL_FUNCTIONS['multiply'](a, b);


Because compiled functions are real async JS functions, nested calls work naturally.

2.2 elements Item

Declarative DOM nodes:

{
  "type": "div|button|input|p|h1|...",
  "id": "optional-id",
  "class": "css-class",
  "text": "textContent",
  "attributes": { "placeholder": "...", "type": "text" },
  "children": [ /* nested elements */ ],
  "events": [
    {
      "event": "click|change|input|submit",
      "function_id": "handle_fn",
      "params": [
        { "from": "element", "id": "fieldId", "extract": "value|text", "type": "number" }
      ]
    }
  ]
}


Events reference a function_id and a typed params array.

The interpreter extracts values from DOM, casts them to the declared type, and passes them to the function.

2.3 css Item
{ "selector": ".my-class", "rules": "padding:8px; color:#222;" }


Engine concatenates all rules and injects into a <style> tag at runtime.

3. Interpreter Architecture — Core Components

Schema Loader
Accepts a JSON schema (local variable, fetched from server, or via WebSocket).

Function Compiler with Async Handling

function compileFunctions(functions) {
    functions.forEach(func => {
        const paramNames = func.params.map(p => p.name);
        const wrappedLogic = `"use strict"; return (async (${paramNames.join(",")}) => { ${func.logic} })();`;
        ALL_FUNCTIONS[func.name] = (...args) => new Function(...paramNames, wrappedLogic)(...args);
    });
}


Logic must contain only the function body, not async function(...) {}.

Wrapper (async (...) => { ... })() ensures await works.

Nested calls via ALL_FUNCTIONS remain valid.

CSS Injector
Concatenate css blocks and inject them into <style>.

DOM Renderer
Recursively create DOM nodes (document.createElement), set attributes, append children, and attach events.

Event Binder & Param Extraction

Event handlers are async:

element.addEventListener(event.event, async () => {
    const args = event.params.map(p => extractAndCast(p));
    await ALL_FUNCTIONS[event.function_id](...args);
});

extractAndCast(p) handles:
number → Number(raw)
boolean → raw === 'true' || Boolean(raw)
string → String(raw)
element → DOM element reference
object/array → parse JSON
Network Helpers (Global Async)
async function doPost(url, body, headers={}) {
    headers = Object.assign({ "Content-Type": "application/json", "Accept": "application/json" }, headers);
    const res = await fetch(url, { method: "POST", headers, body: JSON.stringify(body) });
    return await res.json();
}
Similarly: doGet, doPut, doPatch, doDelete.
Functions in schema can await doPost(...) or call doGet(...).
==========================================================================================
4. Example End-to-End Schema (Async Enabled)
{
  "functions": [
    { "function_id":"parse_num", "params":[{"name":"x","type":"string"}], "logic":"return Number(x);" },
    { "function_id":"mul", "params":[{"name":"a","type":"number"},{"name":"b","type":"number"}], "logic":"return a*b;" },
    { "function_id":"calc", "params":[{"name":"x","type":"string"},{"name":"y","type":"string"}],
      "logic": "const a=await ALL_FUNCTIONS['parse_num'](x); const b=await ALL_FUNCTIONS['parse_num'](y); return await ALL_FUNCTIONS['mul'](a,b);"
    }
  ],
  "elements": [
    { "type":"input", "id":"A", "attributes":{"placeholder":"A"} },
    { "type":"input", "id":"B", "attributes":{"placeholder":"B"} },
    { "type":"button", "text":"Compute",
      "events":[{"event":"click","function_id":"calc","params":[
        {"from":"element","id":"A","extract":"value","type":"string"},
        {"from":"element","id":"B","extract":"value","type":"string"}
      ]}]
    }
  ],
  "css": [ { "selector":"button","rules":"padding:8px 12px;" } ]
}


second example :

{
    "functions": [
        {
            "function_id": "fetch_comments",
            "name": "getComments",
            "params": [
                {
                    "name": "limitInput",
                    "type": "element"
                },
                {
                    "name": "outputElement",
                    "type": "element"
                }
            ],
            "logic": "const limit = Number(limitInput.value); outputElement.textContent = 'Fetching ' + limit + ' comments...'; const response = await doGet('http://jsonplaceholder.typicode.com/comments'); const comments = response.slice(0, limit); let outputHtml = '<h3>Top ' + comments.length + ' Comments:</h3>'; comments.forEach(c => { outputHtml += '<div class=\"comment-item\"><strong>' + c.email + '</strong><p>' + c.body.substring(0, 50) + '...</p></div>'; }); outputElement.innerHTML = outputHtml;"
        },
        {
            "function_id": "clear_output",
            "name": "clearOutput",
            "params": [
                {
                    "name": "outputElement",
                    "type": "element"
                }
            ],
            "logic": "outputElement.innerHTML = '';"
        }
    ],
    "elements": [
        {
            "type": "div",
            "id": "main-container",
            "class": "container",
            "children": [
                {
                    "type": "h2",
                    "text": "Dynamic Comment Fetcher",
                    "class": "header"
                },
                {
                    "type": "input",
                    "id": "limit-input",
                    "attributes": {
                        "placeholder": "Enter number of comments (e.g., 3)",
                        "type": "number",
                        "value": "3"
                    },
                    "class": "input-field"
                },
                {
                    "type": "div",
                    "class": "button-group",
                    "children": [
                        {
                            "type": "button",
                            "text": "Fetch Comments",
                            "class": "action-button fetch",
                            "events": [
                                {
                                    "event": "click",
                                    "function_id": "fetch_comments",
                                    "params": [
                                        {
                                            "from": "element",
                                            "id": "limit-input",
                                            "extract": "element",
                                            "type": "element"
                                        },
                                        {
                                            "from": "element",
                                            "id": "comment-output",
                                            "extract": "element",
                                            "type": "element"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "button",
                            "text": "Clear",
                            "class": "action-button clear",
                            "events": [
                                {
                                    "event": "click",
                                    "function_id": "clear_output",
                                    "params": [
                                        {
                                            "from": "element",
                                            "id": "comment-output",
                                            "extract": "element",
                                            "type": "element"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "div",
                    "id": "comment-output",
                    "class": "output-area",
                    "text": "Click 'Fetch Comments' to load data."
                }
            ]
        }
    ],
    "css": [
        {
            "selector": ".container",
            "rules": "padding: 20px; max-width: 600px; margin: 0 auto; background: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);"
        },
        {
            "selector": ".header",
            "rules": "text-align: center; color: #333;"
        },
        {
            "selector": ".input-field",
            "rules": "width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;"
        },
        {
            "selector": ".button-group",
            "rules": "display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;"
        },
        {
            "selector": ".action-button",
            "rules": "padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold;"
        },
        {
            "selector": ".fetch",
            "rules": "background-color: #007bff;"
        },
        {
            "selector": ".fetch:hover",
            "rules": "background-color: #0056b3;"
        },
        {
            "selector": ".clear",
            "rules": "background-color: #6c757d;"
        },
        {
            "selector": ".clear:hover",
            "rules": "background-color: #5a6268;"
        },
        {
            "selector": ".output-area",
            "rules": "border: 1px solid #eee; padding: 15px; min-height: 100px; background: #f9f9f9; border-radius: 4px; overflow-y: auto;"
        },
        {
            "selector": ".comment-item",
            "rules": "border-bottom: 1px dashed #ddd; padding: 10px 0;"
        },
        {
            "selector": ".comment-item:last-child",
            "rules": "border-bottom: none;"
        }
    ]
}
=================================================================
Clicking Compute triggers async chain: calc → parse_num → mul.
Output can be displayed in the DOM via a show function or additional element.
5. Runtime Flow (Step-by-Step)
renderUI(schema) is called.
compileFunctions(schema.functions) builds async functions in ALL_FUNCTIONS.
renderCSS(schema.css) writes style rules.
createElement() recursively builds the DOM
Event triggers:
Extract DOM values.
Cast values to declared types.
Call await ALL_FUNCTIONS[function_id](...args).
Nested calls execute within the same async runtime.
6. Function Logic Patterns
Simple pure function
"logic": "return a + b;"
Nested async call
"logic": "const x = await ALL_FUNCTIONS['parse_num'](a); return await ALL_FUNCTIONS['mul'](x, 10);"
DOM-aware
"logic": "document.getElementById('out').textContent = 'OK';"
HTTP inside function
"logic": "const res = await doPost('/api', {a:b}); document.getElementById('out').textContent = JSON.stringify(res);"
7. Key Implementation Details
Strict mode: "use strict"; ensures safe execution.
Functions stored as real functions: ALL_FUNCTIONS[id] = compiledFunction.
Typed params: all event params are cast before passing.
Async support: wrapper allows await inside schema logic.
Error handling: try/catch in function logic; interpreter should log missing functions or elements.
8. Security Considerations
Logic execution is potentially dangerous — only load trusted schemas.
Network requests must respect CORS and origin rules.
Optional sandboxing: iframe or web worker to limit global access.
Validate schema shape, param types, and event bindings before compiling.
9. Validation Rules
function_id unique.
All params have name and type.
Events reference existing functions.
Event param from values: element|literal|constant|global.
Safe attribute names and CSS selectors.
Limit function logic length; prevent eval-like constructs inside logic.
10. Extension Points / Roadmap
Async function flag in schema ("async": true).
Sandboxed execution (iframe/worker).
Dynamic schema updates with DOM patching.
Component templates and reuse.
Conditional/computed CSS.
Global state object.
Schema versioning and migration.
Schema validator with detailed errors.
11. Testing Checklist
Unit: validate compilation and param order.
Integration: simulate events and verify async calls.
E2E: schema → UI → user actions → DOM changes.
Security: ensure sandboxing or trusted sources.
12. Concrete Example (Schema → Expected UI)
{
  "functions":[
    {"function_id":"parse_num","params":[{"name":"x","type":"string"}],"logic":"return Number(x);"},
    {"function_id":"sum","params":[{"name":"a","type":"number"},{"name":"b","type":"number"}],"logic":"return a+b;"},
    {"function_id":"show","params":[{"name":"txt","type":"string"}],"logic":"document.getElementById('out').textContent = txt;"}
  ],
  "elements":[
    {"type":"input","id":"A"},
    {"type":"input","id":"B"},
    {"type":"button","text":"Add",
      "events":[{"event":"click","function_id":"show","params":[
        {"from":"element","id":"A","extract":"value","type":"string"},
        {"from":"element","id":"B","extract":"value","type":"string"}
      ]}]
    },
    {"type":"p","id":"out","text":""}
  ],
  "css":[{"selector":"button","rules":"padding:8px;"}]
}
Clicking button: inputs are cast, show is invoked.
If show called async nested functions, await works correctly.
13. Summary Notes
System is minimal, typed, DOM-first, async-safe.
Compiles real async functions, handles nested calls, typed params, DOM extraction, and HTTP helpers.
Production improvements: schema validation, sandboxing, incremental DOM updates, async compiler variant.

1. High-level Purpose
- Declarative Python-dict-driven UI schema
- All `logic` fields must be **JavaScript code** for browser DOM and async network operations
- Function logic should reflect **user input** dynamically

2. Schema Shape
{
    "functions": [],
    "elements": [],
    "css": []
}

2.1 Functions
{
    "function_id": "unique-id",
    "name": "optionalName",
    "params": [
        { "name": "p1", "type": "number|string|element|object|array" }
    ],
    "logic": "// JavaScript DOM-manipulating code only, using user input as needed"
}

- Nested Calls via ALL_FUNCTIONS are allowed
- Event-triggered functions must use **typed DOM-extracted parameters**

2.2 Elements
{
    "type": "div|button|input|p|h1|...",
    "id": "optional-id",
    "class": "css-class",
    "text": "textContent",
    "attributes": { "placeholder": "...", "type": "text" },
    "children": [],
    "events": [
        {
            "event": "click|change|input|submit",
            "function_id": "handle_fn",
            "params": [
                { "from": "element", "id": "fieldId", "extract": "value|text|element", "type": "number|string|element" }
            ]
        }
    ]
}

2.3 CSS
{ "selector": ".my-class", "rules": "padding:8px; color:#222;" }

- Engine injects CSS into <style> at runtime

4. Example End-to-End Schema
{
    "functions": [
        {
            "function_id":"set_greeting",
            "name":"updateGreeting",
            "params":[{"name":"element","type":"element"}],
            "logic":"element.textContent = 'Hello World!';"
        },
        {
            "function_id":"fetch_comments",
            "name":"getComments",
            "params":[{"name":"limit","type":"number"},{"name":"output","type":"element"}],
            "logic":"let comments = await do_get('/comments'); let top = comments.slice(0, limit); output.textContent = JSON.stringify(top);"
        }
    ],
    "elements": [
        {"type":"div","id":"container","children":[
            {"type":"input","id":"limit","attributes":{"placeholder":"Number of comments"}},
            {"type":"button","text":"Fetch","events":[
                {"event":"click","function_id":"fetch_comments","params":[
                    {"from":"element","id":"limit","extract":"value","type":"number"},
                    {"from":"element","id":"container","extract":"element","type":"element"}
                ]}
            ]},
            {"type":"p","id":"output","text":""}
        ]}
    ],
    "css":[{"selector":"button","rules":"padding:8px;"}]
}

- Function logic must be JavaScript and reflect user input
- Schema dict must remain valid Python
- Do not include explanations or text outside the Python dict
+++++++++++++++++++++++++++++++++++++++


